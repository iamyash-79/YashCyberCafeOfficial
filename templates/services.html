<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Services - {{ short_name }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs"></script>
  <style>
    .glass {
      backdrop-filter: blur(16px);
      background: rgba(15, 23, 42, 0.8);
    }
  </style>
</head>
<body class="min-h-screen bg-[#0f172a] text-cyan-100" x-data="{ showAddModal: false, showEditModal: false, editItem: {} }">
<div class="flex">
  <!-- Sidebar -->
  <div class="fixed top-0 left-0 w-56 h-full z-40">
    {% set current_page = 'items' %}
    {% include 'sidebar.html' %}
  </div>

  <!-- Main Content -->
  <main class="ml-56 flex-1 overflow-hidden">
    <!-- Tabs -->
    <div class="sticky top-0 z-30 bg-[#0f172a] border-b border-cyan-700 pt-20">
      <div class="flex space-x-4 px-4 py-2 text-sm">
        <a href="/product" class="border-b-2 border-transparent text-gray-400 hover:text-cyan-400 hover:border-cyan-400">Product</a>
        <a href="/services" class="font-semibold border-b-2 border-cyan-500 text-cyan-400">Services</a>
      </div>
    </div>

    <!-- Flash Messages -->
    <div class="px-4 py-2">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mb-2 space-y-2">
            {% for category, message in messages %}
              <div class="p-2 rounded text-white 
                {% if category == 'success' %}bg-green-600{% elif category == 'error' %}bg-red-600{% else %}bg-blue-600{% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
    </div>

    <!-- Grid -->
    <div class="overflow-y-auto px-2 py-4">
      <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-5 gap-2">
        {% for service in services %}
        <div class="bg-[#1e293b] text-cyan-100 border border-cyan-800 rounded-lg p-2 text-xs shadow-md">
          <h2 class="font-bold text-center truncate">{{ service.name }}</h2>
          <p class="text-center my-1">
            {% if service.discount_price %}
              <span class="line-through text-gray-400">₹{{ service.price }}</span>
              <span class="text-green-400 font-bold ml-1">₹{{ service.discount_price }}</span>
            {% else %}
              ₹{{ service.price }}
            {% endif %}
          </p>
          <p class="text-[10px] text-center text-gray-400 truncate">{{ service.description }}</p>
          <div class="flex space-x-1 mt-2">
            <form method="POST" action="/delete_service/{{ service.id }}" onsubmit="return confirm('Delete this service?')" class="w-1/2">
              <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white py-[2px] rounded text-[10px]">❌</button>
            </form>
            <button 
              class="w-1/2 bg-cyan-700 hover:bg-cyan-800 text-white py-[2px] rounded text-[10px]"
              @click="showEditModal = true; editItem = {
                id: '{{ service.id }}',
                name: '{{ service.name|escape }}',
                price: '{{ service.price }}',
                discount_price: '{{ service.discount_price or '' }}',
                description: `{{ service.description|escape }}`
              }"
            >✏️</button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Floating Add Button -->
    <button @click="showAddModal = true" class="fixed bottom-6 right-6 bg-cyan-600 hover:bg-cyan-700 text-white px-5 py-3 rounded-full shadow-xl text-sm">
      + Add Service
    </button>
  </main>
</div>

<!-- Add Modal -->
<div x-show="showAddModal" x-cloak class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
  <div class="glass border border-cyan-400 p-6 rounded-2xl shadow-2xl max-w-md w-full text-cyan-100 relative">
    <button @click="showAddModal = false" class="absolute top-2 right-3 text-cyan-400 hover:text-red-400 text-xl">✖</button>
    <h2 class="text-2xl font-bold mb-4 text-center text-cyan-300">Add New Service</h2>
    <form action="/services" method="POST" class="space-y-4">
      <input name="name" placeholder="Name" required class="w-full px-3 py-2 rounded bg-[#0f172a] border border-cyan-500 text-cyan-100 placeholder-cyan-400" />
      <input name="price" type="number" placeholder="Price" required class="w-full px-3 py-2 rounded bg-[#0f172a] border border-cyan-500 text-cyan-100 placeholder-cyan-400" />
      <input name="discount_price" type="number" placeholder="Discount Price" class="w-full px-3 py-2 rounded bg-[#0f172a] border border-cyan-500 text-cyan-100 placeholder-cyan-400" />
      <textarea name="description" placeholder="Description" class="w-full px-3 py-2 rounded bg-[#0f172a] border border-cyan-500 text-cyan-100 placeholder-cyan-400"></textarea>
      <div class="flex justify-end gap-2">
        <button type="button" @click="showAddModal = false" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">Cancel</button>
        <button type="submit" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded">Add</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Modal -->
<div x-show="showEditModal" x-cloak class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
  <div class="glass border border-cyan-400 p-6 rounded-2xl shadow-2xl max-w-md w-full text-cyan-100 relative">
    <button @click="showEditModal = false" class="absolute top-2 right-3 text-cyan-400 hover:text-red-400 text-xl">✖</button>
    <h2 class="text-2xl font-bold mb-4 text-center text-cyan-300">Edit Service</h2>
    <form :action="`/edit_service/${editItem.id}`" method="POST" class="space-y-4" id="editForm">
      <input name="name" x-model="editItem.name" required class="w-full px-3 py-2 rounded bg-[#0f172a] border border-cyan-500 text-cyan-100 placeholder-cyan-400" />
      <input name="price" type="number" x-model="editItem.price" required class="w-full px-3 py-2 rounded bg-[#0f172a] border border-cyan-500 text-cyan-100 placeholder-cyan-400" />
      <input name="discount_price" type="number" x-model="editItem.discount_price" class="w-full px-3 py-2 rounded bg-[#0f172a] border border-cyan-500 text-cyan-100 placeholder-cyan-400" />
      <textarea name="description" x-model="editItem.description" class="w-full px-3 py-2 rounded bg-[#0f172a] border border-cyan-500 text-cyan-100 placeholder-cyan-400"></textarea>
      <div class="flex justify-end gap-2">
        <button type="button" @click="showEditModal = false" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">Cancel</button>
        <button type="submit" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded">Update</button>
      </div>
    </form>
  </div>
</div>
</body>
</html>
